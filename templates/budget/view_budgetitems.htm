<link href="/media_site/style.css" rel="stylesheet" type="text/css" />
{% load user_group %}
{% block body %}
<h1>Budget Details</h1>

<br/>
Budget Name: {{budget.name}} </br>
Position: {{budget.position.name}}</br>
Start Date: {{budget.start_date}}</br>
End Date: {{budget.end_date}}</br>
Stream: {{budget.stream}}</br></br></br>

	{% if full %}
	<h2> Category Breakdown </h2><br/>
		<table>
		<tr>
			<th>Category</th>
			<th>Budgeted Amount</th>
			<th>Actual Amount</th>
		</tr>
		{% for c in budget_items_in_cat %}
		<tr>
			<td>{{c.income_category__name}}</td>
			<td align='right'>{{c.sum|floatformat:2}}</td>
			<td align='right'>
				{% for a in transactions_in_cat %}
					{% ifequal a.income_category__name c.income_category__name %}
						{{a.sum|floatformat:2}}
					{% endifequal %}
				{% endfor %}
			</td>
		</tr>
		{% endfor %}
		<tr>
			<td><b>Income Total</td>
			<td align='right'><b>{{in_tot|floatformat:2}}</td>
			<td align='right'><b>{{transactions_in_tot|floatformat:2}}</td>
		</tr>
		
		{% for c in budget_items_ex_cat %}
		<tr>
			<td>{{c.expenditure_category__name}}</td>
			<td align='right'>{{c.sum|floatformat:2}}</td>
			<td align='right'>
				{% for a in transactions_ex_cat %}
					{% ifequal a.expenditure_category__name c.expenditure_category__name %}
						{{a.sum|floatformat:2}}
					{% endifequal %}
				{% endfor %}
			</td>
		</tr>
		{% endfor %}
		<tr>
			<td><b>Expenditure Total</td>
			<td align='right'><b>{{ex_tot|floatformat:2}}</td>
			<td align='right'><b>{{transactions_ex_tot|floatformat:2}}</td>
		</tr>
		
		</table>
		<br/><br/>
		<h2> Budget Items</h2>
		<table>
			<tr>
				<th>Category</th>
				<th>Description</th>
				<th>Amount</th>
			</tr>
		{% for b in budget_items_in %}

			<tr>
				<td>{{b.income_category}}</td>
				<td>{{b.description}}</td>
				<td align='right'>{{b.amount|floatformat:2}}</td>
			</tr>

		{% endfor %}
			<tr>
				<td><b>Income Total:</b></td>
				<td></td>
				<td align='right'><b>{{in_tot|floatformat:2}}</b></td>
			</tr>
		{% for b in budget_items_ex %}
			<tr>
				<td>{{b.expenditure_category}}</td>
				<td>{{b.description}}</td>
				<td align='right'>{{b.amount|floatformat:2}}</td>
			</tr>

		{% endfor %}
			<tr><b>
				<td><b>Expenditure Total:</b></td>
				<td></td>
				<td align='right'><b>{{ex_tot|floatformat:2}}</b></td>
			</b></tr>
			<tr><b>
				<td><b>Net:</b></td>
				<td></td>
				<td align='right'><b>{{net|floatformat:2}}</b></td>
			</b></tr>			
			
		</table>
		{% if user|in_group:"vp_finance,admin" %}
			{% if budget.approved %}
				<a href="{% url budget_approved_switch id=budget.id %}" onClick="javascript:window.close();"><button>Un-Approve</button></a>
			{% else %}
				<a href="{% url budget_approved_switch id=budget.id %}" onClick="javascript:window.close();"><button>Approve</button></a>
			{% endif %}
		{% endif %}
	{% else %}
		<a href="{% url budget_create_budgetitems id=budget.id %}">Enter in Details</a>
	{% endif %}
		
	<a href="{% url budget_view_budgets %}" onClick="javascript:window.close();"><button>Cancel</button></a> <br/><br/>
	
	<h1>Previous Budgets</h1>
	{% for b in previous_budgets %}
		<p>{{b.name}} || {{b.term}} || {{b.start_date.year}} || {{b.stream}}
		<a href="#" id="{{b.id}}-show" class="showLink" onclick="showHide('{{b.id}}');return false;">More</a>
		</p>
		<div id="{{b.id}}" class="more">
		<p><a href="#" id="{{b.id}}-hide" class="hideLink" onclick="showHide('{{b.id}}');return false;">Less</a></p>
			<b>Income Items</b>
			<table class="sortable" width=500 cellpadding=0 cellspacing=0>
				<tr>
					<td bgcolor="#ccc">Description</td>
					<td bgcolor="#ccc">Category</td>
					<td bgcolor="#ccc">Budgeted</td>
					<td bgcolor="#ccc">Actual</td>
				</tr>

				{% for bi in previous_bi_in %}
					{% ifequal bi.budget b %}
					<tr>
						<td>{{bi.description}}</td>
						<td>{{bi.income_category}}</td>
						<td align='right'>{{bi.amount|floatformat:2}}</td>
						<td></td>
					</tr>
					{% endifequal %}
				{% endfor %}
				<tr>
					<td>Total Income</td>
					<td></td>
					<td align='right'>
				{% for i in total_in %}
					{% ifequal i.budget b.id %}{{i.sum|floatformat:2}}{% endifequal %}
				{% endfor %}
						</td>
					<td></td>
				</tr>
				</table>
				
				<b>Expenditure Items</b>
				<table class="sortable" width=500 cellpadding=0 cellspacing=0>
					<tr>
						<td bgcolor="#ccc">Description</td>
						<td bgcolor="#ccc">Category</td>
						<td bgcolor="#ccc">Budgeted</td>
						<td bgcolor="#ccc">Actual</td>
					</tr>
				{% for bi in previous_bi_ex %}
					{% ifequal bi.budget b.id %}
					<tr>
						<td>{{bi.description}}</td>
						<td>{{bi.expenditure_category}}</td>
						<td align='right'>{{bi.amount|floatformat:2}}</td>
						<td></td>
					</tr>
					{% endifequal %}
				{% endfor %}
				<tr>
					<td>Total Expenditure</td>
					<td></td>
					<td align='right'>
				{% for i in total_ex %}
					{% ifequal i.budget b.id %}{{i.sum|floatformat:2}}{% endifequal %}
				{% endfor %}
					</td>
					<td></td>
				</tr>

			</table><br/><br/>
			
		</div>
	
	{% endfor %}
	
	
	{% block extra_body %}
    <script type="text/javascript">
		function showHide(shID) {
		if (document.getElementById(shID)) {
			if (document.getElementById(shID+'-show').style.display != 'none') {
				document.getElementById(shID+'-show').style.display = 'none';
				document.getElementById(shID).style.display = 'block';
			}
			else {
				document.getElementById(shID+'-show').style.display = 'inline';
				document.getElementById(shID).style.display = 'none';
			}
		}
	}
	</script>
	{% endblock extra_body %}

{% endblock body %}